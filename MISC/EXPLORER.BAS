DECLARE SUB PALET (a%, r%, g%, b%)
DECLARE SUB fade (t%)
DECLARE SUB generate ()
DECLARE SUB floor (lv%)
DEFINT A-Z

DIM SHARED l(21, 13, 1 TO 3)
DIM SHARED p%(256, 24), pr(15), pg(15), pb(15)

RANDOMIZE TIMER
pr(0) = 0: pg(0) = 0: pb(0) = 0
pr(1) = 0: pg(1) = 0: pb(1) = 32
pr(2) = 0: pg(2) = 32: pb(2) = 0
pr(3) = 0: pg(3) = 32: pb(3) = 32
pr(4) = 32: pg(4) = 0: pb(4) = 0
pr(5) = 32: pg(5) = 0: pb(5) = 32
pr(6) = 32: pg(6) = 32: pb(6) = 0
pr(7) = 40: pg(7) = 40: pb(7) = 40
pr(8) = 28: pg(8) = 28: pb(8) = 28
pr(9) = 0: pg(9) = 0: pb(9) = 63
pr(10) = 0: pg(10) = 63: pb(10) = 0
pr(11) = 0: pg(11) = 63: pb(11) = 63
pr(12) = 63: pg(12) = 0: pb(12) = 0
pr(13) = 63: pg(13) = 0: pb(13) = 63
pr(14) = 63: pg(14) = 63: pb(14) = 0
pr(15) = 63: pg(15) = 63: pb(15) = 63


SCREEN 13
fade -4
FOR a = 1 TO 15
CIRCLE (160, 100), a, a
CIRCLE (161, 100), a, a
NEXT a
fade 40
CLS
GOSUB pics
CALL generate
DO
floor 1: DO: LOOP WHILE INKEY$ = ""
floor 2: DO: LOOP WHILE INKEY$ = ""
floor 3: DO: LOOP WHILE INKEY$ = ""
LOOP
END


pics:
'1 FLOOR      2 WALL      3 SPACE    4 HOLE
'5 END        6 YOU       7 KEYR     8 KEYB
'9 KEYW       10 COIN     11 DOORR   12 DOORB
'13 LAVA o    14 LAVA +   15 LAVA -  16 LAVA |
'17 HAMMER    18 BRIDGE   19 ULADDER 20 DLADDER
'21 ROLLER U  22 ROLLER L 23 ROLLERR 24 ROLLER D
FOR n = 1 TO 16
fade -7
LINE (1, 1)-(16, 16), 0, BF
IF n > 5 AND n < 11 THEN PUT (1, 1), p%(0, 1), PSET
FOR y = 1 TO 16
FOR x = 1 TO 16
READ p
IF p > 0 THEN
IF p = 3 THEN p = 7 + CINT(RND) * 8
IF p = 1 THEN p = 1 + CINT(RND) * 8
IF p = 2 THEN p = 2 + CINT(RND) * 8
IF p = 4 THEN p = 4 + CINT(RND) * 8: IF RND > .7 THEN p = 14
PSET (x, y), p
END IF
NEXT x
NEXT y
fade 3
GET (1, 1)-(16, 16), p%(0, n)
NEXT n
LINE (1, 1)-(16, 16), 0, BF
RETURN
' 1
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0
DATA 2,2,2,2,0,0,0,0,0,0,0,0,0,2,0,0
DATA 0,0,0,2,0,0,0,0,0,0,0,0,2,2,0,0
DATA 0,0,0,0,2,0,0,0,0,0,2,2,0,0,0,0
DATA 0,0,0,0,2,2,2,2,0,0,2,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0
DATA 0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,2,0,0,2,2,2,2,0,0,0,0
DATA 0,0,0,0,2,2,0,0,0,0,0,2,0,0,0,0
DATA 0,0,2,2,0,0,0,0,0,0,0,0,2,0,0,0
DATA 0,0,2,0,0,0,0,0,0,0,0,0,2,2,2,2
DATA 0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0
'  2
DATA 1,3,3,3,3,3,3,3,3,3,3,3,3,3,3,1
DATA 3,1,3,3,3,3,3,3,3,3,3,3,3,3,1,2
DATA 3,3,1,3,3,3,3,3,3,3,3,3,3,1,2,2
DATA 3,3,3,1,1,1,1,1,1,1,1,1,1,2,2,2
DATA 3,3,3,1,1,2,2,2,2,2,2,1,1,2,2,2
DATA 3,3,3,1,2,1,2,2,2,2,1,3,1,2,2,2
DATA 3,3,3,1,2,2,1,2,2,1,3,3,1,2,2,2
DATA 3,3,3,1,2,2,2,0,0,3,3,3,1,2,2,2
DATA 3,3,3,1,2,2,2,0,0,3,3,3,1,2,2,2
DATA 3,3,3,1,2,2,1,3,3,1,3,3,1,2,2,2
DATA 3,3,3,1,2,1,3,3,3,3,1,3,1,2,2,2
DATA 3,3,3,1,1,3,3,3,3,3,3,1,1,2,2,2
DATA 3,3,3,1,1,1,1,1,1,1,1,1,1,2,2,2
DATA 3,3,1,2,2,2,2,2,2,2,2,2,2,1,2,2
DATA 3,1,2,2,2,2,2,2,2,2,2,2,2,2,1,2
DATA 1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1
'   3
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,1,0,0,0,3,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,3,0,0,0,0,0,0,0,0,0,2,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
'    2
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0
DATA 2,2,2,2,0,0,0,0,0,0,0,0,0,2,0,0
DATA 0,0,0,2,0,0,0,0,0,0,0,0,2,2,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,2,2,0,0,0,0,0,0,0,0,2,0,0,0
DATA 0,0,2,0,0,0,0,0,0,0,0,0,2,2,2,2
DATA 0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0
'     5
DATA 0,0,0,0,0,0,1,1,1,1,0,0,0,2,0,0
DATA 0,0,0,0,0,3,3,1,1,3,3,0,0,2,0,0
DATA 2,2,2,2,3,3,3,3,3,3,3,3,0,2,0,0
DATA 0,0,0,3,3,0,2,2,2,2,0,3,3,2,0,0
DATA 0,0,3,3,0,0,2,2,2,2,0,0,3,3,0,0
DATA 0,3,3,0,0,1,1,1,1,1,1,0,0,3,3,0
DATA 1,3,3,0,0,2,2,2,2,2,2,0,0,3,3,1
DATA 1,1,3,0,0,2,2,2,2,2,2,0,0,3,1,1
DATA 1,1,3,0,1,1,1,1,1,1,1,1,0,3,1,1
DATA 1,3,3,0,2,2,2,2,2,2,2,2,0,3,3,1
DATA 0,3,3,0,2,2,2,2,2,2,2,2,0,3,3,0
DATA 0,0,3,1,1,1,1,1,1,1,1,1,1,3,0,0
DATA 0,0,2,3,2,2,2,2,2,2,2,2,3,0,0,0
DATA 0,0,2,0,3,2,2,2,2,2,2,3,2,2,2,2
DATA 0,0,2,0,0,3,3,3,3,3,3,0,0,0,0,0
DATA 0,0,2,0,0,0,1,1,1,1,0,0,0,0,0,0
'      6
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,3,3,0,0,0,0,0,0,3,3,0,0,0
DATA 0,0,3,1,1,3,0,0,0,0,3,1,1,3,0,0
DATA 0,0,3,2,1,3,2,2,2,2,3,1,2,3,0,0
DATA 0,0,0,3,3,2,2,2,2,2,2,3,3,0,0,0
DATA 0,0,0,0,2,2,2,2,2,2,2,2,0,0,0,0
DATA 0,0,3,3,2,2,2,2,2,2,2,2,3,3,0,0
DATA 0,3,0,0,2,2,2,2,2,2,2,2,0,0,3,0
DATA 3,0,3,0,2,2,2,2,2,2,2,2,0,3,0,3
DATA 3,0,3,0,2,2,2,3,3,2,2,2,0,3,0,3
DATA 0,0,0,0,0,2,3,0,0,3,2,0,0,0,0,0
DATA 0,0,0,0,0,3,0,0,0,0,3,0,0,0,0,0
DATA 0,0,0,0,0,3,0,0,0,0,3,0,0,0,0,0
DATA 0,0,0,0,0,3,0,0,0,0,3,0,0,0,0,0
DATA 0,0,3,3,3,3,0,0,0,0,3,3,3,3,0,0
DATA 0,0,3,3,3,3,3,0,0,3,3,3,3,3,0,0
'       7
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,2,2,2,2,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,2,2,3,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0
DATA 0,0,0,0,2,2,2,2,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,2,1,3,3,0,0,0,0,0,0,0
DATA 0,0,0,0,2,1,1,3,3,2,0,0,0,0,0,0
DATA 0,0,0,2,1,1,1,1,1,1,2,0,0,0,0,0
DATA 0,0,0,0,2,1,1,1,1,2,0,0,0,0,0,0
DATA 0,0,0,0,0,2,2,2,2,0,0,0,0,0,0,0
'        8
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,1,3,3,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0
DATA 0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,1,2,3,3,0,0,0,0,0,0,0
DATA 0,0,0,0,1,2,2,3,3,1,0,0,0,0,0,0
DATA 0,0,0,1,2,2,2,2,2,2,1,0,0,0,0,0
DATA 0,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0
DATA 0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0
'         9
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,3,0,3,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,3,0,3,0,0,0,0,0,0,0
DATA 0,0,0,0,0,3,0,3,0,3,0,0,0,0,0,0
DATA 0,0,0,0,0,3,0,3,0,3,0,0,0,0,0,0
DATA 0,0,0,0,0,3,0,3,0,3,0,0,0,0,0,0
DATA 0,0,0,0,0,3,0,3,0,3,0,0,0,0,0,0
DATA 0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0
DATA 0,0,0,0,0,3,2,2,2,3,0,0,0,0,0,0
DATA 0,0,0,0,3,3,2,2,2,2,3,0,0,0,0,0
DATA 0,0,0,0,3,1,3,3,3,2,3,0,0,0,0,0
DATA 0,0,0,0,3,1,1,1,1,3,3,0,0,0,0,0
DATA 0,0,0,0,0,3,1,1,1,3,0,0,0,0,0,0
DATA 0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0
'          10
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,0
DATA 0,0,0,0,3,1,1,1,1,1,3,0,0,0,0,0
DATA 0,0,0,3,1,1,1,1,1,1,1,3,0,0,0,0
DATA 0,0,3,3,1,2,2,1,1,1,1,1,3,0,0,0
DATA 0,0,3,3,1,2,2,1,3,3,1,1,3,0,0,0
DATA 0,0,3,2,3,1,1,3,2,2,3,1,3,0,0,0
DATA 0,0,3,2,2,3,3,2,1,1,2,3,3,0,0,0
DATA 0,0,3,2,2,2,2,2,1,1,2,3,3,0,0,0
DATA 0,0,0,3,2,2,2,2,2,2,2,3,0,0,0,0
DATA 0,0,0,0,3,2,2,2,2,2,3,0,0,0,0,0
DATA 0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
'           11
DATA 0,0,0,0,3,3,3,3,3,3,3,3,0,0,0,0
DATA 0,0,3,3,2,2,2,2,2,2,2,2,3,3,0,0
DATA 0,3,2,2,2,2,2,2,2,2,2,2,2,2,3,0
DATA 0,3,2,2,2,2,3,3,3,3,2,2,2,2,3,0
DATA 3,2,2,2,3,3,0,0,0,0,3,3,2,2,2,3
DATA 3,2,2,2,3,0,0,2,2,0,0,3,2,2,2,3
DATA 3,2,2,3,0,0,2,0,2,2,0,0,3,2,2,3
DATA 3,2,2,3,0,0,2,2,0,2,0,0,3,2,2,3
DATA 3,2,2,3,0,0,2,2,0,2,0,0,3,2,2,3
DATA 3,2,2,3,0,0,2,0,2,2,0,0,3,2,2,3
DATA 3,2,2,2,3,0,0,2,2,0,0,3,2,2,2,3
DATA 3,2,2,2,3,3,0,0,0,0,3,3,2,2,2,3
DATA 0,3,2,2,2,2,3,3,3,3,2,2,2,2,3,0
DATA 0,3,2,2,2,2,2,2,2,2,2,2,2,2,3,0
DATA 0,0,3,3,2,2,2,2,2,2,2,2,3,3,0,0
DATA 0,0,0,0,3,3,3,3,3,3,3,3,0,0,0,0
'            12
DATA 0,0,0,0,3,3,3,3,3,3,3,3,0,0,0,0
DATA 0,0,3,3,1,1,1,1,1,1,1,1,3,3,0,0
DATA 0,3,1,1,1,1,1,1,1,1,1,1,1,1,3,0
DATA 0,3,1,1,1,1,3,3,3,3,1,1,1,1,3,0
DATA 3,1,1,1,3,3,0,0,0,0,3,3,1,1,1,3
DATA 3,1,1,1,3,0,0,1,1,0,0,3,1,1,1,3
DATA 3,1,1,3,0,0,1,1,0,1,0,0,3,1,1,3
DATA 3,1,1,3,0,0,1,0,1,1,0,0,3,1,1,3
DATA 3,1,1,3,0,0,1,0,1,1,0,0,3,1,1,3
DATA 3,1,1,3,0,0,1,1,0,1,0,0,3,1,1,3
DATA 3,1,1,1,3,0,0,1,1,0,0,3,1,1,1,3
DATA 3,1,1,1,3,3,0,0,0,0,3,3,1,1,1,3
DATA 0,3,1,1,1,1,3,3,3,3,1,1,1,1,3,0
DATA 0,3,1,1,1,1,1,1,1,1,1,1,1,1,3,0
DATA 0,0,3,3,1,1,1,1,1,1,1,1,3,3,0,0
DATA 0,0,0,0,3,3,3,3,3,3,3,3,0,0,0,0
'             13
DATA 0,0,0,0,0,0,1,1,1,1,0,0,0,2,0,0
DATA 0,0,0,0,0,3,3,3,3,3,3,0,0,2,0,0
DATA 2,2,2,2,3,3,4,4,4,4,3,3,0,2,0,0
DATA 0,0,0,3,3,4,4,4,4,4,4,3,3,2,0,0
DATA 0,0,3,3,4,4,4,4,4,4,4,4,3,3,0,0
DATA 0,3,3,4,4,4,4,4,4,4,4,4,4,3,3,0
DATA 1,3,4,4,4,4,4,4,4,4,4,4,4,4,3,1
DATA 1,3,4,4,4,4,4,4,4,4,4,4,4,4,3,1
DATA 1,3,4,4,4,4,4,4,4,4,4,4,4,4,3,1
DATA 1,3,4,4,4,4,4,4,4,4,4,4,4,4,3,1
DATA 0,3,3,4,4,4,4,4,4,4,4,4,4,3,3,0
DATA 0,0,3,3,4,4,4,4,4,4,4,4,3,3,0,0
DATA 0,0,2,3,3,4,4,4,4,4,4,3,3,0,0,0
DATA 0,0,2,0,3,3,4,4,4,4,3,3,2,2,2,2
DATA 0,0,2,0,0,3,3,3,3,3,3,0,0,0,0,0
DATA 0,0,2,0,0,0,1,1,1,1,0,0,0,0,0,0
'              14
DATA 0,3,4,4,4,4,4,4,4,4,4,4,4,4,3,0
DATA 3,3,4,4,4,4,4,4,4,4,4,4,4,4,3,3
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 3,3,4,4,4,4,4,4,4,4,4,4,4,4,3,3
DATA 0,3,4,4,4,4,4,4,4,4,4,4,4,4,3,0
'               15
DATA 0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0
DATA 3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
DATA 3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3
DATA 0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0
'                16
DATA 0,3,4,4,4,4,4,4,4,4,4,4,4,4,3,0
DATA 0,3,4,4,4,4,4,4,4,4,4,4,4,4,3,0
DATA 0,3,4,4,4,4,4,4,4,4,4,4,4,4,3,0
DATA 0,3,4,4,4,4,4,4,4,4,4,4,4,4,3,0
DATA 0,3,4,4,4,4,4,4,4,4,4,4,4,4,3,0
DATA 0,3,4,4,4,4,4,4,4,4,4,4,4,4,3,0
DATA 0,3,4,4,4,4,4,4,4,4,4,4,4,4,3,0
DATA 1,3,4,4,4,4,4,4,4,4,4,4,4,4,3,1
DATA 1,3,4,4,4,4,4,4,4,4,4,4,4,4,3,1
DATA 0,3,4,4,4,4,4,4,4,4,4,4,4,4,3,0
DATA 0,3,4,4,4,4,4,4,4,4,4,4,4,4,3,0
DATA 0,3,4,4,4,4,4,4,4,4,4,4,4,4,3,0
DATA 0,3,4,4,4,4,4,4,4,4,4,4,4,4,3,0
DATA 0,3,4,4,4,4,4,4,4,4,4,4,4,4,3,0
DATA 0,3,4,4,4,4,4,4,4,4,4,4,4,4,3,0
DATA 0,3,4,4,4,4,4,4,4,4,4,4,4,4,3,0
'                 17
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
'                  18
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
'                   19
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
'                    20
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
'                     21
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
'                      22
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
'                       23
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
'                        24
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0

SUB fade (t)
g = t
IF g < 0 THEN
	g = -g
	FOR b = g TO 0 STEP -1
	FOR a = 1 TO 15: PALET a, pr(a) * b / g, pg(a) * b / g, pb(a) * b / g: NEXT a
	NEXT b
ELSE
	FOR b = 0 TO g
	FOR a = 1 TO 15: PALET a, pr(a) * b / g, pg(a) * b / g, pb(a) * b / g: NEXT a
	NEXT b
END IF
END SUB

SUB floor (lv)
fade -1
FOR x = 1 TO 20
FOR y = 1 TO 12
PUT (x * 16 - 16, y * 16 - 16), p%(0, l(x, y, lv)), PSET
NEXT y
NEXT x
fade 1
END SUB

SUB generate
DIM t(21, 13)
FOR l = 1 TO 3
	FOR y = 0 TO 13
		FOR x = 0 TO 21
			l(x, y, l) = 1 + RND
			IF RND > .97 THEN l(x, y, l) = 4
			IF RND > .97 THEN l(x, y, l) = 10
			IF RND > .97 THEN l(x, y, l) = 11
			IF RND > .97 THEN l(x, y, l) = 12
			IF RND > .97 THEN l(x, y, l) = 7
			IF RND > .97 THEN l(x, y, l) = 8
			IF RND > .97 THEN l(x, y, l) = 9
		NEXT x
	NEXT y
	sx = INT(20 * RND + 1): sy = INT(12 * RND + 1)
	l(sx, sy, l) = 6
	sx = INT(20 * RND + 1): sy = INT(12 * RND + 1)
	FOR a = 1 TO INT(10 * RND + 10)
		d = INT(4 * RND)
		IF d = 0 THEN sx = sx: sy = sy + 1
		IF d = 1 THEN sx = sx: sy = sy - 1
		IF d = 2 THEN sx = sx + 1: sy = sy
		IF d = 3 THEN sx = sx - 1: sy = sy
		IF sx >= 0 AND sy >= 0 AND sx <= 21 AND sy <= 13 THEN l(sx, sy, l) = 3
	NEXT a

	FOR n = 1 TO 7
		sx = INT(20 * RND + 1): sy = INT(12 * RND + 1): d = INT(4 * RND)
		FOR a = 1 TO INT(10 * RND + 10)
			IF d = 0 THEN px = sx: py = sy + a
			IF d = 1 THEN px = sx: py = sy - a
			IF d = 2 THEN px = sx + a: py = sy
			IF d = 3 THEN px = sx - a: py = sy
			IF px >= 0 AND py >= 0 AND px <= 21 AND py <= 13 THEN l(px, py, l) = 13
		NEXT a
	NEXT n
	FOR y = 1 TO 12
		FOR x = 1 TO 20
			IF l(x, y, l) = 1 THEN
				c = 0
				IF l(x, y - 1, l) = 2 THEN c = 1
				IF l(x, y + 1, l) = 2 THEN c = c + 1
				IF l(x - 1, y, l) = 2 THEN c = c + 1
				IF l(x + 1, y, l) = 2 THEN c = c + 1
				IF c > 2 THEN l(x, y, l) = 2
			END IF
			IF l(x, y, l) = 2 THEN
				c = 0
				IF l(x, y - 1, l) = 1 THEN c = 1
				IF l(x, y + 1, l) = 1 THEN c = c + 1
				IF l(x - 1, y, l) = 1 THEN c = c + 1
				IF l(x + 1, y, l) = 1 THEN c = c + 1
				IF c > 2 THEN l(x, y, l) = 1
			END IF
		NEXT x
	NEXT y
	FOR x = 0 TO 21: FOR y = 0 TO 13: t(x, y) = l(x, y, l): NEXT y: NEXT x
	FOR x = 1 TO 20
		FOR y = 1 TO 12
			IF l(x, y, l) = 13 THEN
				c = 0
				IF l(x, y - 1, l) = 13 THEN c = 1
				IF l(x, y + 1, l) = 13 THEN c = c + 2
				IF l(x - 1, y, l) = 13 THEN c = c + 4
				IF l(x + 1, y, l) = 13 THEN c = c + 8
				IF c > 0 THEN t(x, y) = 14
				IF c = 1 OR c = 2 OR c = 3 THEN t(x, y) = 16
				IF c = 4 OR c = 8 OR c = 12 THEN t(x, y) = 15
			END IF
		NEXT y
	NEXT x
	FOR x = 0 TO 21: FOR y = 0 TO 13:  l(x, y, l) = t(x, y): NEXT y: NEXT x
NEXT l
END SUB

SUB PALET (a, r, g, b)
OUT &H3C7, a: OUT &H3C8, a
OUT &H3C9, r: OUT &H3C9, g: OUT &H3C9, b
END SUB

